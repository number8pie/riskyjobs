#NEXT COMMIT MESSAGE:

The query is now built unsing a user defined function called build_query.